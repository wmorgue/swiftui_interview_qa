# Swift Intermediate Language (SIL)

SIL — высокоуровневая семантическая информация (представление) о коде SSA формы IR. Такое представление необходимо для реализации языка Swift. `SIL` используется для анализа потока данных, который обеспечивает выполнение требования самого языка Swift, таких как, например, окончательная инициализация переменных и конструкторов, достижимость различных участков кода, покрытие всех условий switch’a.
Также благодаря `SIL` осуществляются более высокоуровневые оптимизации: retain/release оптимизация, девиртуализация динамических функций, closure inlining, создание и спецификация generic-функций.

## SSA

`Static Single Assignment` — позволяет выражать код программы в виде графа. В нем отсутствуют переменные в привычном нам понимании.

## 2 формы SIL

SIL представляется двумя инвариантами:

1. Raw SIL — данная форма получается на этапе SILGen, она не оптимизирована и не продиагностировано. Raw SIL может содержать в себе ошибки потоков данных, некоторые инструкции могут находиться в неканонических представлениях. Данный формат не должен быть использован для генерации или распространения нативного кода.

2. Canonical SIL — форма, получаемая из Raw SIL после диагностики и оптимизации. В ней уже устранены все ошибки потоков данных, и инструкции приведены к каноническим представлениям. Только эту форму можно использовать для генерации промежуточного представления LLVM или распространения.

## Использование

```bash
# Abstract syntax tree (AST)
swiftc -dump-ast example.swift

# Swift intermediate language(SIl) без оптимизаций
swiftc -emit-silgen example.swift


# SIL с оптимизациями
swiftc -emit-sil example.swift

# LLVM Intermediate representation(IR) с оптимизациями LLVM
swiftc -emit-ir example.swift

# Ассемблер. Финальный вариант, после всех этапов выше.
swiftc -S example.swift
```

Но при этом важно понимать, что в SIL все символы подвергаются так называемому `Name mangling` и становится не ясно, где и какой символ ты сейчас видишь. Обратная процедура называется деманглингом и выполняется так:

```bash
swiftc -emit-sil example.swift | swift demangle
```

## Полная инструкция

[Доступна в репозитории компилятора](https://github.com/apple/swift/blob/main/docs/SIL.rst).